!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n=class{constructor(){this._events=[]}on(t,e){return this.addEventListerner(t,e)}addEventListerner(t,e){return this._events.push({name:t,callback:e})-1}removeEventListerner(t){this._events[t]=void 0}_emit(t,...e){for(let i of this._events)void 0!==i&&i.name==t&&"function"==typeof i.callback&&i.callback(...e)}_pass(t){return function(...e){this._emit(t,e)}.bind(this)}};var o=class extends n{constructor(){super(),this._audio=new Audio,this._audio.addEventListener("error",this._pass("error")),this._audio.addEventListener("timeupdate",this._pass("timeupdate")),this._audio.addEventListener("ended",this._pass("ended"))}playSongById(t){if(!t)return void this._emit("error",new Error("id is not defined or empty"));let e=this.isPaused||!this._audio.src;this._audio.pause(),this._audio.src="api/songs/"+t+"/file",this._audio.play(),e&&this._emit("pauseChaned",!0),this._emit("songsChanged",t)}pause(){this._audio.isPaused||(this._audio.pause(),this._emit("pauseChaned",!1))}stop(){this._audio.pause(),this._emit("pauseChaned",!1),this._audio.src=""}play(){this._audio.src&&(this._audio.play(),this._emit("pauseChaned",!0))}togglePause(){this._audio.paused?(this._audio.play(),this._emit("pauseChaned",!0)):(this._audio.pause(),this._emit("pauseChaned",!1))}skipTimeTo(t){return!!this._audio.src&&(this._audio.currentTime=t,!0)}get isPaused(){return this._audio.paused}set volume(t){this._audio.volume=t}get volume(){return this._audio.volume}get duration(){return this._audio.duration}get currentTime(){return this._audio.currentTime}edit(t,e,i){$.ajax({url:"api/songs/"+t,method:"PATCH",data:e,success:function(){"function"==typeof i&&i()},error:this._ajaxErrorHandle})}uploadSong(t,e,i){0!=t.elements.file.files.length&&$.ajax({xhr:function(){if("function"==typeof i)return i()},url:"api/songs/",method:"POST",data:new FormData(t),contentType:!1,cache:!1,processData:!1,success:function(t,i,n){"function"==typeof e&&e(t,i,n)},error:this._ajaxErrorHandle})}fetchSongList(t){$.ajax({method:"GET",url:"api/songs",success:function(e){"function"==typeof t&&t(e)}.bind(this),error:this._ajaxErrorHandle})}static secToMin(t){let e=t%60,i=Math.floor(t/60)+":";return i+=e<10?"0"+e:e}deleteSong(t,e){if(!t)throw new TypeError("id is undefined or null");$.ajax({method:"DELETE",url:"api/songs/"+t,success:function(){"function"==typeof e&&e()}.bind(this),error:this._ajaxErrorHandle})}downloadYT(t){$.get({url:"api/downloadYoutube",data:{id:t},error:this._ajaxErrorHandle})}_ajaxErrorHandle(t,e,i){this._emit("error",i)}};var s=class extends o{constructor(){super(),this.songs=[]}get currentSong(){return this._currentSong}updateSongList(t){this.fetchSongList(function(e){this.songs=e,"function"==typeof t&&t()}.bind(this))}playSongById(t){super.playSongById(t),this._currentSong=t}stop(){super.stop(),this._currentSong=null}readyToPlay(){return!!this._currentSong}};var a=class{constructor(t){this._things=t,this._args=null,this._isHidden=!0,this._buildDom(),document.addEventListener("click",function(){this._isHidden||this.hide()}.bind(this))}get args(){return this._args}_buildDom(){let t=document.createElement("div");t.id="contextmenu";let e=document.createElement("ul");t.appendChild(e);for(let t of this._things){let i=document.createElement("li");i.innerText=t.title,i.addEventListener("click",function(){"function"==typeof t.callback&&t.callback(...this._args),this.hide()}.bind(this)),e.appendChild(i)}this._dom=$(t),this.hide(),document.body.appendChild(t)}displayAt(t,...e){this._args=e,this._isHidden=!1,this._dom.css({visibility:"hidden"}),t.clientX+200>$(window).width()?this._dom.css({top:t.pageY+"px",left:t.pageX-200+"px",visibility:"visible"}):this._dom.css({top:t.pageY+"px",left:t.pageX+"px",visibility:"visible"}),t.preventDefault()}hide(){this._dom.css({visibility:"hidden"}),this._isHidden=!0}};!function(){let t,e=new s;window.onload=function(){let i=new Vue({el:"#songTable",data:function(){return{songs:e.songs,sortKey:0,sortAsc:!0}},methods:{updateSongs:function(){e.updateSongList(function(){this.songs=e.songs}.bind(this))},getSortKeyValue:function(t){switch(this.sortKey){case 0:return t.metadata.title;case 1:return t.metadata.artist;case 2:return t.metadata.album;case 3:return t.duration;default:return t.metadata.title}},changeSortKey:function(t){this.sortKey=t,this.sortAsc=!this.sortAsc},doubleClick:function(t){e.playSongById(this.filteredSongs[t].id)},playNext:function(){let t=this.filteredSongs.findIndex(function(t){return t.id==e.currentSong});t<this.songs.length-1&&e.playSongById(this.filteredSongs[t+1].id)},playPrevious:function(){let t=this.filteredSongs.findIndex(function(t){return t.id==e.currentSong});t>0&&e.playSongById(this.filteredSongs[t-1].id)},contextMenu:function(e,i){t.displayAt(i,this.filteredSongs[e])},presedPlay:function(){console.log("presed Playe"),e.readyToPlay()?(e.togglePause(),console.log(e.readyToPlay())):this.songs.length>=1&&e.playSongById(this.filteredSongs[0].id)}},computed:{filteredSongs:function(){return this.songs.sort(function(t,e){return this.getSortKeyValue(t)<this.getSortKeyValue(e)?this.sortAsc?-1:1:this.getSortKeyValue(t)>this.getSortKeyValue(e)?this.sortAsc?1:-1:null==this.getSortKeyValue(t)?this.sortAsc?1:-1:null==this.getSortKeyValue(e)?this.sortAsc?-1:1:0}.bind(this))}}});t=new a([{title:"Play",callback:function(t){e.playSongById(t.id)}},{title:"Edit",callback:function(t){$("#editModalID").val(t.id),$("#editModalTitle").val(t.metadata.title),$("#editModalArtist").val(t.metadata.artist),$("#editModalAlbum").val(t.metadata.album),$("#editModalGenre").val(t.metadata.genre),$("#editModalYear").val(t.metadata.year),$("#editModalFile").val(t.file),$("#editModal").modal("show")}},{title:"Delete",callback:function(t){$("#deleteModalSongname").text(t.title),$("#deleteModal").modal("show")}}]),e.on("ended",function(){i.playNext()}),e.on("error",function(t){}),e.on("timeupdate",function(){$("#progressSongBar").width(e.currentTime/e.duration*100+"%")}),e.on("pauseChaned",function(){e.isPaused?$("#start-stop").attr("class","glyphicon glyphicon-play pointer"):$("#start-stop").attr("class","glyphicon glyphicon-pause pointer")}),i.updateSongs(),$("#backBtn").on("click",function(){i.playPrevious()}),$("#start-stop").on("click",function(){i.presedPlay()}),$("#nextBtn").on("click",function(){i.playNext()}),$("#progressSong").on("click",function(t){var i=t.offsetX/document.getElementById("progressSong").offsetWidth;e.skipTimeTo(e.duration*i)&&$("#progressSongBar").width(100*i+"%")});let n=this.document.getElementById("volumeSlider");var o=function(){e.volume=n.value/100,n.value>=90?$("#volumeSpan").attr("class","glyphicon glyphicon-volume-up pointer"):n.value>0?$("#volumeSpan").attr("class","glyphicon glyphicon-volume-down pointer"):$("#volumeSpan").attr("class","glyphicon glyphicon-volume-off pointer")};n.oninput=o,o(),$("#volume").on("click",function(){"hidden"==$("#volumeSliderContainer").css("visibility")?$("#volumeSliderContainer").css("visibility","visible"):$("#volumeSliderContainer").css("visibility","hidden")});let s=!0;$(document).on("keydown",function(t){32==t.keyCode&&s&&(i.presedPlay(),t.preventDefault())}),$(".modal").on("shown.bs.modal",function(){s=!1}),$(".modal").on("hidden.bs.modal",function(){s=!0}),$("#deleteModalBtn").on("click",function(){var n=t.args[0].id;e.deleteSong(n,function(){i.updateSongs(),e.currentSong==n&&e.stop()})}),$("#editModalBtn").on("click",function(){e.edit($("#editModalID").val(),{title:$("#editModalTitle").val(),artist:$("#editModalArtist").val(),album:$("#editModalAlbum").val()},function(){i.updateSongs()})}),$("#addModalYTdlBtn").on("click",function(){var t=$("#ytdlURL").val(),i=new URL(t).searchParams.get("v");e.downloadYT(i)}),$("#addModalUploadBtn").on("click",function(){e.uploadSong(document.getElementById("uploadModalForm"),function(){$("#uploadModal").modal("hide"),$("#uploadModalAlbum").val(""),$("#uploadModalArtist").val(""),$("#uploadModalTitle").val(""),$("#uploadModalFile").val(null),$("#uploadModalProgress").width("0%"),i.updateSongs()},function(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){if(t.lengthComputable){var e=parseInt(t.loaded/t.total*100);$("#uploadModalProgress").width(e+"%")}},t})}),window.addEventListener("message",function(t){switch(t.data.action){case"pausePlay":i.presedPlay();break;case"next":e.playNext();break;case"previous":e.playPrevious()}})}}()}]);
//# sourceMappingURL=bundle.js.map